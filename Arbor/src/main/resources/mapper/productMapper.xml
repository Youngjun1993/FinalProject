<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.arbor.home.dao.ProductDAOImp">
 	<select id="mainCateList" resultType="com.arbor.home.vo.MainCateVO">
 		select mainno, mainname from maincate
 	</select>
 	
 	<select id="subCateList" parameterType="int" resultType="com.arbor.home.vo.SubCateVO">
 		select mainno, subno, subname from subcate where mainno=${param1}
 	</select>
 	
 	<select id="subCateListAll" resultType="com.arbor.home.vo.SubCateVO">
 		select subno, s.mainno, mainname, subname from subcate s join maincate m
 		on s.mainno=m.mainno order by subno 
 	</select>
 	
 	<insert id="productInsert" parameterType="com.arbor.home.vo.ProductVO">
 		insert into product(pno, subno, pname, stock, allstock, pprice, saleprice, img1,
 		<if test='#{img2}!=null || #{img2}!=""'>img2, </if>description)
 		values(productsq.nextval, ${subno}, #{pname}, ${stock}, ${allstock}, ${pprice}, ${saleprice},
 		#{img1}, <if test='#{img2}!=null || #{img2}!=""'> #{img2}, </if>#{description})
 	</insert>
 	
 	<insert id="optionInsert" parameterType="com.arbor.home.vo.OptionVO">
 		insert into optiontbl(optno, pno, optname, optvalue, optprice, rgbvalue)
 		values(optionsq.nextval, ${pno}, #{optname}, #{optvalue}, ${optprice}, #{rgbvalue})
 	</insert>
 	
 	<select id="pnoSelect" resultType="int">
 		select pno from product where subno=${param1} and pname=#{param2}
 	</select>
 	
 	<select id="productList" resultType="com.arbor.home.vo.ProductVO">
 		select p.pno, s.mainname, s.subname, p.pname, p.saleprice, p.stock, 
 		to_char(p.pdate, 'yyyy-mm-dd') as pdate from product p join (select s.subno, s.subname, m.mainname 
 		from subcate s join maincate m on s.mainno=m.mainno) s on p.subno=s.subno order by pno desc
 	</select>
 	
 	<select id="productSelect" parameterType="int" resultType="com.arbor.home.vo.ProductVO">
 		select pno, mainno, s.subno, pname, stock, pprice, saleprice, img1, img2, description
		from product p
		join (select s.subno, s.subname, m.mainno from subcate s join maincate m on s.mainno=m.mainno) s
		on p.subno=s.subno where pno=${param1}
 	</select>
 	
 	<select id="optionSelect" parameterType="int" resultType="com.arbor.home.vo.OptionVO">
 		select optno, optname, optvalue, optprice, rgbvalue from optiontbl where pno=${param1}
 	</select>
 	
 	<update id="productUpdate" parameterType="com.arbor.home.vo.ProductVO">
 		update product set subno=${subno}, pname=#{pname}, pprice=${pprice}, saleprice=${saleprice},
 		stock=${stock}, img1=#{img1}, <if test='#{img2}!=null || #{img2}!=""'>img2=#{img2}, </if>description=#{description} where pno=${pno}
 	</update>
 	
 	<delete id="optionDelete" parameterType="int">
 		delete from optiontbl where optno=${param1}
 	</delete>
 	
 	<update id="optionUpdate" parameterType="com.arbor.home.vo.OptionVO">
 		update optiontbl set pno=${pno}, optname=#{optname}, optvalue=#{optvalue}, rgbvalue=#{rgbvalue},
 		optprice=${optprice} where optno=${optno}
 	</update>
 	
 	<delete id="productDelete" parameterType="int">
 		delete from product where pno=${param1}
 	</delete>
 	
 	<delete id="optionAllDelete" parameterType="int">
 		delete from optiontbl where pno=${param1}
 	</delete>
 	
 	<select id="productListClient" parameterType="int" resultType="com.arbor.home.vo.ProductVO">
 		select pno, subno, pname, pprice, saleprice, img1, img2 from product where subno=${param1}
 	</select>
 	
 	<select id="productListRGB" parameterType="int" resultType="com.arbor.home.vo.OptionVO">
 		select o.pno, rgbvalue from optiontbl o join product p on o.pno=p.pno where p.subno=${param1}
 	</select>
 	
 	<select id="mainnameSelect" parameterType="int" resultType="string">
 		select mainname from maincate where mainno=${param1}
 	</select>
 	
 	<select id="optNameSelect" parameterType="int" resultType="com.arbor.home.vo.OptionVO">
 		select DISTINCT(optname) as optname from optiontbl where pno=${param1}
 	</select>
 	
 	<select id="optValueSelect" parameterType="int" resultType="com.arbor.home.vo.OptionVO">
 		select optno, optname, optvalue, optprice from optiontbl where pno=${param1} order by optname
 	</select>
 	
 	<insert id="pqnaInsert" parameterType="com.arbor.home.vo.ProductQnaVO">
 		insert into productqna(pqnano, pno, userid, pqnasubject, pqnacontent, pqnaopen)
 		values(pqnasq.nextval, ${pno}, #{userid}, #{pqnasubject}, #{pqnacontent}, #{pqnaopen})
 	</insert>
 	
 	<select id="pqnaList" resultType="com.arbor.home.vo.ProductQnaVO">
 		select pqnano, p.pno, pname, userid, pqnasubject, pqnacontent, panswercontent, pqnadate from productqna q join product p on q.pno=p.pno
 	</select>
 	
 	<select id="pqnaAnswer" resultType="com.arbor.home.vo.ProductQnaVO">
 		select pqnano, p.pno, pname, userid, pqnasubject, pqnacontent, panswercontent, pqnadate from productqna q join product p on q.pno=p.pno where pqnano=${param1}
 	</select>
 	
 	<select id="pqnaNoAnswerCnt" resultType="int">
 		select count(pqnano) from productqna where panswercontent is null
 	</select>
 	
 	<update id="pqnaAnswerInsert" parameterType="com.arbor.home.vo.ProductQnaVO">
 		update productqna set panswercontent=#{panswercontent} where pqnano=${pqnano}
 	</update>
 	
 	<update id="pqnaAnswerDelete" parameterType="int">
 		update productqna set pqnasubject='해당 문의글은 블라인드 처리 되었습니다.',
 		pqnacontent='해당 문의글은 블라인드 처리 되었습니다.', panswercontent='해당 문의글은 블라인드 처리 되었습니다.' where pqnano=${param1}
 	</update>
 	
 	<select id="pqnaViewList" parameterType="int" resultType="com.arbor.home.vo.ProductQnaVO">
 		select pqnano, pno, substr(userid,1,3) || lpad('*',length(userid)-2,'*'), pqnasubject, pqnacontent,  nvl(panswercontent, '답변 대기중 입니다.') as panswercontent,
 		to_char(pqnadate, 'yyyy-mm-dd') as pqnadate, pqnaopen from productqna where pno=${param1}
 	</select>
 </mapper>